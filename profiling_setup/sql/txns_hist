WITH blocks(id, number) AS (
	SELECT *
	FROM block_number_mat_view
	ORDER BY 2 DESC
	LIMIT 2000
),
subspans AS (
	SELECT blocks.number, subspans_lat.*
	FROM blocks, LATERAL (
		SELECT spans.id
		FROM parent_references_func(blocks.id)
		JOIN spans ON spans.id = parent_references_func.span_id
		WHERE spans.operation_id = 19 -- apply_transaction
	) subspans_lat
),
counts AS(
SELECT count(*) 
FROM subspans as t1
GROUP BY t1.number
)
	
SELECT counts.count, count(*)
FROM counts
GROUP BY 1
;
